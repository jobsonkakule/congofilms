{% extends "base.html.twig" %}

{% block title post.title %}
    
{% block body %}
    <div class="container">
        <div class="crumb">
            <span>
            <a href="{{ path('home') }}">Accueil</a>
            </span>
            {% if post.category %}
                <i class="fas fa-chevron-right"></i>
                <span>
                    <a href="{{ path('category.show', {id: post.category.id, slug: post.category.slug}) }}">{{ post.category.title }}</a>
                </span>
            {% endif %}
            {% if post.tags | length > 0 %}
                <i class="fas fa-chevron-right"></i>
                <span>
                    <a href="{{ path('post.index') }}?tag={{ post.tags[0] }}">{{ post.tags[0] }}</a>
                </span>
            {% endif %}
            <i class="fas fa-chevron-right"></i>
            <span>
            <a>{{ post.title }}</a>
            </span>
        </div>
        <div class="row">
            <div class="col-md-8">
            <div class="post-header">
                <ul class="category">
                    <li><a href="{{ path('category.show', {id: post.category.id, slug: post.category.slug}) }}">{{ post.category.title }}</a></li>
                    {% if post.tags | length > 0 %}
                        <li>
                            <a href="{{ path('post.index') }}?tag={{ post.tags[0] }}">{{ post.tags[0] }}</a>
                        </li>
                    {% endif %}
                </ul>
                <div class="post-title">
                    <h1>{{ post.title }}</h1>
                    <div class="post-info">
                        <div class="post-author">
                            Par 
                            <a href="{{ path('profil.show', {id: post.author.id}) }}">
                                {% if post.author.pseudo is not null %}
                                    {{ post.author.pseudo }}
                                {% else %}
                                    {{ post.author.username }}
                                {% endif %}
                            </a> 
                            - 
                        </div>
                        {#<span class="post-date">{{ post.createdAt | date("d F, Y") }}</span>#}
                        <span class="post-date">{{ post.createdAt | localizeddate('long', 'short') }}</span>
                        <div class="post-stat">
                        <a href="#comments">
                            <i class="fas fa-comments"></i>
                            {{ post.comments | length }}
                        </a>
                        </div>
                        <div class="post-stat">
                        <i class="fas fa-eye"></i>
                        {{ post.views }}
                        </div>
                    </div>
                </div>
            </div>
            <div class="sharing-post">
                <span><i class="fas fa-share-alt"></i></span>
                <a href="">
                    <div class="share-icon">
                        <i class="fab fa-facebook-f"></i>
                    </div>
                    <div class="share-text">
                        Facebook
                    </div>
                </a>
                <a href="">
                <div class="share-icon" style="background: #29c5f6">
                    <i class="fab fa-twitter"></i>
                </div>
                <div class="share-text" style="background: #29c5f6">
                    Twitter
            </div>
                </a>
                <a href="">
                <div class="share-icon" style="background: #7bbf6a">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <div class="share-text" style="background: #7bbf6a">
                    Whatsapp
                </div>
                </a>
            </div>
            <div class="post-content">
                <div data-slider class="post-featured-img">
                    {% if post.pictures is not empty %}
                        {% for picture in post.pictures %}
                            <img src="{{ vich_uploader_asset(picture, 'imageFile') }}" alt="" title="{{ post.title }}">
                        {% endfor %}
                    {% endif %}
                </div>
                <div>
                    {{ post.content | raw }}
                </div>
                <ul class="td-tags">
                    {% if post.tags | length > 0 %}
                        <li style="display: inline;">
                            <span>TAGS</span>
                        </li>
                        {% for tag in post.tags %}
                            <li style="display: inline;">
                                <a href="{{ path('post.index') }}?tag={{ tag }}">{{ tag }}</a>
                            </li>
                        {% endfor %}
                    {% endif %}
                </ul>
                <hr>
                <div class="sharing-post sharing-bottom">
                <a href="">
                    <div class="share-icon" style="background: #1b2e3f">
                        <i class="far fa-thumbs-up"></i>
                        <span>1205</span>
                    </div>
                </a>
                &nbsp;
                et
                &nbsp;
                <span><i class="fas fa-share-alt"></i></span>
                <a href="">
                    <div class="share-icon">
                    <i class="fab fa-facebook-f"></i>
                    </div>
                </a>
                <a href="">
                    <div class="share-icon" style="background: #29c5f6">
                    <i class="fab fa-twitter"></i>
                    </div>
                </a>
                <a href="">
                    <div class="share-icon" style="background: #7bbf6a">
                    <i class="fab fa-whatsapp"></i>
                    </div>
                </a>
                ou
                <a href="" class="post-comment">
                    <div class="share-icon" style="background: #1b2e3f; color:#FFF;">
                    <i class="far fa-comment"></i>
                    </div>
                </a>
                </div>
                <hr>
                <div class="cat-high-toggle">
                <h6>
                    <a href="" class="toggle-item cat-high-selected">articles associés</a>
                    <a href="" class="toggle-item">Plus de l'auteur</a>
                </h6>
                </div>
                <div class="row last-articles">
                    {% set others = [] %}
                    {% for p in associatedPosts %}
                      {% set postItem = p[0] %}
                      {% if (postItem.id != post.id) %}
                        {% set others = others | merge([p]) %}
                      {% endif %}
                    {% endfor %}
                    {% if others %}
                        {% for p in others | slice(0, 3) %}
                        {% set postItem = p[0] %}
                            <div class="col-md-4 last-art-item">
                                <div class="cat-post-img">
                                <a href="{{ path('post.show', {id: postItem.id, slug: postItem.slug}) }}">
                                    {% if postItem.picture %}
                                        <img src="{{ vich_uploader_asset(postItem.picture, 'imageFile') | imagine_filter('thumb') }}" alt="">
                                    {% else %}
                                        <img src="{{ '/images/noimage.png'| imagine_filter('thumb') }}" alt="" title="{{ postItem.title }}"></a>
                                    {% endif %}
                                <a href="{{ path('category.show', {id: p.id, slug: postItem.category.slug}) }}" class="item-cat">{{ p.title }}</a>
                                </div>
                                <div class="cat-post-body">
                                <a href="{{ path('post.show', {id: postItem.id, slug: postItem.slug}) }}"><h6>{{ postItem.title }}</h6></a>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="justify-content-center">
                            <h3 style="color: #777;">Aucun contenu à afficher</h3>
                        </div>
                    {% endif %}
                </div>
                <br>
                <div class="pagination justify-content-center">
                    {{ knp_pagination_render(associatedPosts) }}
                </div>
                {% include "post/_form.html.twig" %}
            </div>
            </div>
            <div class="col-md-4 article-reminder">
                <div style="width: 100%; height: 200px; background:gray;text-align:center;color:#FFF;">
                    Publicité
                </div>
                <br>
                {{ sidebar() }}
            </div>
        </div>
    </div>
    <div class="pub-2">

    </div>
    <br>
{% endblock %}